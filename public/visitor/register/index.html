<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DernSupport - Register</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      :root {
        --dark-blue: #111827;
        --medium-blue: #2563eb;
        --light-blue: #60a5fa;
        --light-gray: #d1d5db;
        --success-green: #22c55e;
        --error-red: #ef4444;
        --transition: all 0.3s ease;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, sans-serif;
      }

      body {
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #111827, #374151);
        padding: 20px;
        color: #f3f4f6;
      }

      .register-container {
        background: rgba(31, 42, 68, 0.95);
        padding: 3rem;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        width: 100%;
        max-width: 600px;
        margin: 2rem auto;
        animation: fadeIn 0.5s ease forwards;
      }

      .logo {
        text-align: center;
        margin-bottom: 2rem;
      }

      .logo-text {
        font-size: 2rem;
        font-weight: 700;
        color: #f3f4f6;
      }

      .logo-text span {
        color: var(--medium-blue);
      }

      .form-title {
        font-size: 1.5rem;
        color: #f3f4f6;
        margin-bottom: 1.5rem;
        font-weight: 600;
        text-align: center;
      }

      .form-row {
        display: flex;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      @media screen and (max-width: 768px) {
        .form-row {
          flex-direction: column;
          gap: 0;
        }
      }

      .form-group {
        flex: 1;
        margin-bottom: 1.5rem;
        position: relative;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        color: #f3f4f6;
        font-weight: 500;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 0.875rem;
        border: none;
        border-radius: 6px;
        background-color: #374151;
        color: #f3f4f6;
        font-size: 1rem;
        transition: var(--transition);
      }

      .form-group textarea {
        resize: vertical;
        min-height: 100px;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
      }

      .error-message {
        color: var(--error-red);
        font-size: 0.875rem;
        margin-top: 0.5rem;
        display: none;
      }

      .password-toggle {
        position: absolute;
        right: 1rem;
        top: 2.75rem;
        color: #9ca3af;
        cursor: pointer;
        font-size: 1.1rem;
      }

      .password-strength {
        display: flex;
        height: 5px;
        margin-top: 0.75rem;
        overflow: hidden;
        border-radius: 2px;
      }

      .password-strength span {
        flex: 1;
        height: 100%;
        background-color: #4b5563;
        margin-right: 2px;
        transition: var(--transition);
      }

      .password-strength span:last-child {
        margin-right: 0;
      }

      .password-strength-text {
        font-size: 0.8rem;
        margin-top: 0.25rem;
        color: #9ca3af;
      }

      .password-weak span:nth-child(1) {
        background-color: var(--error-red);
      }

      .password-good span:nth-child(1),
      .password-good span:nth-child(2) {
        background-color: #f59e0b;
      }

      .password-strong span:nth-child(1),
      .password-strong span:nth-child(2),
      .password-strong span:nth-child(3) {
        background-color: var(--success-green);
      }

      .checkbox-group {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1.5rem;
      }

      .checkbox-group input {
        margin-top: 0.25rem;
        margin-right: 0.75rem;
      }

      .checkbox-group label {
        color: #f3f4f6;
        font-size: 0.9rem;
        line-height: 1.5;
      }

      .checkbox-group a {
        color: var(--light-blue);
        text-decoration: none;
        font-weight: 600;
      }

      .checkbox-group a:hover {
        text-decoration: underline;
      }

      .btn {
        display: block;
        width: 100%;
        padding: 0.875rem;
        border: none;
        border-radius: 6px;
        background-color: var(--medium-blue);
        color: #ffffff;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
      }

      .btn:hover {
        background-color: #1d4ed8;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .btn:disabled {
        background-color: #6b7280;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }

      .login-link {
        text-align: center;
        margin-top: 1.5rem;
        color: #9ca3af;
      }

      .login-link a {
        color: var(--light-blue);
        text-decoration: none;
        font-weight: 600;
      }

      .login-link a:hover {
        text-decoration: underline;
      }

      .role-selector {
        display: block;
        margin-bottom: 1.5rem;
      }

      .role-options {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 1rem;
      }

      .role-option {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 40%;
        min-width: 150px;
        max-width: 500px;
        margin: 0 auto 1rem;
        border: 2px solid #374151;
        border-radius: 8px;
        padding: 1.5rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background-color: #1f2a44;
      }

      .role-option:hover {
        border-color: #2563eb;
        transform: translateY(-2px);
      }

      .role-option.selected {
        border-color: #2563eb;
        background-color: rgba(37, 99, 235, 0.1);
      }

      .role-option i {
        font-size: 1.5rem;
        color: #2563eb;
        margin-bottom: 0.5rem;
      }

      .role-option h3 {
        font-size: 1rem;
        margin-bottom: 0.5rem;
        color: #f3f4f6;
        white-space: nowrap;
      }

      .role-option p {
        font-size: 0.85rem;
        color: #9ca3af;
        max-width: 90%;
      }

      .hidden-input {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .shake {
        animation: shake 0.5s cubic-bezier(0.36, 0.07, 0.19, 0.97) both;
      }

      @keyframes shake {
        10%,
        90% {
          transform: translate3d(-1px, 0, 0);
        }
        20%,
        80% {
          transform: translate3d(2px, 0, 0);
        }
        30%,
        50%,
        70% {
          transform: translate3d(-4px, 0, 0);
        }
        40%,
        60% {
          transform: translate3d(4px, 0, 0);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }
    </style>
  </head>
  <body>
    <div class="register-container">
      <div class="logo">
        <div class="logo-text">Dern<span>Support</span></div>
      </div>

      <h2 class="form-title">Create Your Account</h2>

      <form id="registerForm" novalidate>
        <!-- Role Selection -->
        <div
          class="role-selector"
          role="radiogroup"
          aria-labelledby="role-label"
        >
          <span id="role-label" class="visually-hidden"
            >Select account type</span
          >
          <div class="role-options">
            <input
              type="radio"
              name="role"
              value="individual"
              id="individualRole"
              class="hidden-input"
              checked
            />
            <label
              for="individualRole"
              class="role-option selected"
              id="individualOption"
              tabindex="0"
            >
              <i class="fas fa-user"></i>
              <h3>Individual</h3>
              <p>Personal computer support and repairs</p>
            </label>

            <input
              type="radio"
              name="role"
              value="business"
              id="businessRole"
              class="hidden-input"
            />
            <label
              for="businessRole"
              class="role-option"
              id="businessOption"
              tabindex="0"
            >
              <i class="fas fa-building"></i>
              <h3>Business</h3>
              <p>IT support for your company</p>
            </label>
          </div>
        </div>

        <!-- Personal Information -->
        <div class="form-row">
          <div class="form-group">
            <label for="firstName">First Name*</label>
            <input
              type="text"
              id="firstName"
              name="firstName"
              required
              aria-describedby="firstNameError"
            />
            <div class="error-message" id="firstNameError"></div>
          </div>

          <div class="form-group">
            <label for="lastName">Last Name*</label>
            <input
              type="text"
              id="lastName"
              name="lastName"
              required
              aria-describedby="lastNameError"
            />
            <div class="error-message" id="lastNameError"></div>
          </div>
        </div>

        <div class="form-group">
          <label for="email">Email Address*</label>
          <input
            type="email"
            id="email"
            name="email"
            required
            aria-describedby="emailError"
          />
          <div class="error-message" id="emailError"></div>
        </div>

        <div class="form-group">
          <label for="phone">Phone Number*</label>
          <input
            type="tel"
            id="phone"
            name="phone"
            placeholder="+1 (123) 456-7890"
            required
            aria-describedby="phoneError"
          />
          <div class="error-message" id="phoneError"></div>
        </div>

        <div class="form-group">
          <label for="address">Address*</label>
          <textarea
            id="address"
            name="address"
            placeholder="Street, City, State, Zip Code"
            required
            aria-describedby="addressError"
          ></textarea>
          <div class="error-message" id="addressError"></div>
        </div>

        <!-- Business-specific fields -->
        <div id="businessFields" style="display: none">
          <div class="form-group">
            <label for="companyName">Company Name*</label>
            <input
              type="text"
              id="companyName"
              name="companyName"
              aria-describedby="companyNameError"
            />
            <div class="error-message" id="companyNameError"></div>
          </div>

          <div class="form-group">
            <label for="employeeCount">Number of Employees</label>
            <select id="employeeCount" name="employeeCount">
              <option value="1-10">1-10</option>
              <option value="11-50">11-50</option>
              <option value="51-200">51-200</option>
              <option value="201+">201+</option>
            </select>
          </div>
        </div>

        <!-- Password Fields -->
        <div class="form-row">
          <div class="form-group">
            <label for="password">Password*</label>
            <input
              type="password"
              id="password"
              name="password"
              required
              aria-describedby="passwordError"
            />
            <i class="fas fa-eye password-toggle" id="passwordToggle"></i>
            <div class="password-strength">
              <span></span>
              <span></span>
              <span></span>
            </div>
            <div class="password-strength-text"></div>
            <div class="error-message" id="passwordError"></div>
          </div>

          <div class="form-group">
            <label for="confirmPassword">Confirm Password*</label>
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              required
              aria-describedby="confirmPasswordError"
            />
            <i
              class="fas fa-eye password-toggle"
              id="confirmPasswordToggle"
            ></i>
            <div class="error-message" id="confirmPasswordError"></div>
          </div>
        </div>

        <div class="checkbox-group">
          <input
            type="checkbox"
            id="termsAccept"
            name="termsAccept"
            required
            aria-describedby="termsAcceptError"
          />
          <label for="termsAccept">
            I agree to the <a href="#">Terms of Service</a> and
            <a href="#">Privacy Policy</a>
          </label>
        </div>
        <div class="error-message" id="termsAcceptError"></div>

        <button type="submit" class="btn" id="registerButton">
          Create Account
        </button>
      </form>

      <div class="login-link">
        Already have an account? <a href="/login">Log in</a>
      </div>
    </div>

    <script>
      // Elements
      const elements = {
        registerForm: document.getElementById("registerForm"),
        firstNameInput: document.getElementById("firstName"),
        lastNameInput: document.getElementById("lastName"),
        emailInput: document.getElementById("email"),
        phoneInput: document.getElementById("phone"),
        addressInput: document.getElementById("address"),
        passwordInput: document.getElementById("password"),
        confirmPasswordInput: document.getElementById("confirmPassword"),
        termsAcceptCheckbox: document.getElementById("termsAccept"),
        companyNameInput: document.getElementById("companyName"),
        firstNameError: document.getElementById("firstNameError"),
        lastNameError: document.getElementById("lastNameError"),
        emailError: document.getElementById("emailError"),
        phoneError: document.getElementById("phoneError"),
        addressError: document.getElementById("addressError"),
        passwordError: document.getElementById("passwordError"),
        confirmPasswordError: document.getElementById("confirmPasswordError"),
        termsAcceptError: document.getElementById("termsAcceptError"),
        companyNameError: document.getElementById("companyNameError"),
        individualRole: document.getElementById("individualRole"),
        businessRole: document.getElementById("businessRole"),
        individualOption: document.getElementById("individualOption"),
        businessOption: document.getElementById("businessOption"),
        businessFields: document.getElementById("businessFields"),
        passwordStrength: document.querySelector(".password-strength"),
        passwordStrengthText: document.querySelector(".password-strength-text"),
        registerButton: document.getElementById("registerButton"),
        passwordToggle: document.getElementById("passwordToggle"),
        confirmPasswordToggle: document.getElementById("confirmPasswordToggle"),
      };

      // Role selection toggle
      elements.individualOption.addEventListener("click", () => {
        elements.individualRole.checked = true;
        elements.individualOption.classList.add("selected");
        elements.businessOption.classList.remove("selected");
        elements.businessFields.style.display = "none";
        elements.companyNameInput.removeAttribute("required");
      });

      elements.businessOption.addEventListener("click", () => {
        elements.businessRole.checked = true;
        elements.businessOption.classList.add("selected");
        elements.individualOption.classList.remove("selected");
        elements.businessFields.style.display = "block";
        elements.companyNameInput.setAttribute("required", "");
      });

      // Keyboard support for role selection
      [elements.individualOption, elements.businessOption].forEach((option) => {
        option.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === "Space") {
            e.preventDefault();
            option.click();
          }
        });
      });

      // Password visibility toggle
      elements.passwordToggle.addEventListener("click", () => {
        const type =
          elements.passwordInput.type === "password" ? "text" : "password";
        elements.passwordInput.type = type;
        elements.passwordToggle.classList.toggle("fa-eye");
        elements.passwordToggle.classList.toggle("fa-eye-slash");
      });

      elements.confirmPasswordToggle.addEventListener("click", () => {
        const type =
          elements.confirmPasswordInput.type === "password"
            ? "text"
            : "password";
        elements.confirmPasswordInput.type = type;
        elements.confirmPasswordToggle.classList.toggle("fa-eye");
        elements.confirmPasswordToggle.classList.toggle("fa-eye-slash");
      });

      // Helper functions
      function showError(element, message) {
        element.textContent = message;
        element.style.display = "block";
        element.parentElement
          .querySelector("input, textarea, select")
          ?.classList.add("shake");
        setTimeout(() => {
          element.parentElement
            .querySelector("input, textarea, select")
            ?.classList.remove("shake");
        }, 500);
      }

      function hideError(element) {
        element.style.display = "none";
      }

      function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
      }

      function validatePhone(phone) {
        const re = /^[+]?[(]?[0-9]{3}[)]?[-\s.]?[0-9]{3}[-\s.]?[0-9]{4,6}$/;
        return re.test(phone.replace(/\s+/g, ""));
      }

      function checkPasswordStrength(password) {
        let strength = 0;
        if (password.length >= 8) strength += 1;
        if (/[a-z]/.test(password) && /[A-Z]/.test(password)) strength += 1;
        if (/[0-9]/.test(password)) strength += 1;

        elements.passwordStrength.className = "password-strength";
        elements.passwordStrengthText.textContent = "";

        if (password.length === 0) return 0;

        if (strength === 1) {
          elements.passwordStrength.classList.add("password-weak");
          elements.passwordStrengthText.textContent =
            "Weak - Add mixed case or numbers";
          elements.passwordStrengthText.style.color = "var(--error-red)";
        } else if (strength === 2) {
          elements.passwordStrength.classList.add("password-good");
          elements.passwordStrengthText.textContent =
            "Good - Consider adding numbers";
          elements.passwordStrengthText.style.color = "#f59e0b";
        } else if (strength === 3) {
          elements.passwordStrength.classList.add("password-strong");
          elements.passwordStrengthText.textContent = "Strong - Excellent!";
          elements.passwordStrengthText.style.color = "var(--success-green)";
        }

        return strength;
      }

      // Password strength listener
      elements.passwordInput.addEventListener("input", () => {
        checkPasswordStrength(elements.passwordInput.value);
      });

      // Form validation and submission
      elements.registerForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        let isValid = true;

        // Reset errors
        Object.values(elements)
          .filter((el) => el.id && el.id.endsWith("Error"))
          .forEach(hideError);

        // Validate inputs
        if (!elements.firstNameInput.value.trim()) {
          showError(elements.firstNameError, "First name is required");
          isValid = false;
        }

        if (!elements.lastNameInput.value.trim()) {
          showError(elements.lastNameError, "Last name is required");
          isValid = false;
        }

        if (!elements.emailInput.value.trim()) {
          showError(elements.emailError, "Email is required");
          isValid = false;
        } else if (!validateEmail(elements.emailInput.value)) {
          showError(elements.emailError, "Please enter a valid email address");
          isValid = false;
        }

        if (!elements.phoneInput.value.trim()) {
          showError(elements.phoneError, "Phone number is required");
          isValid = false;
        } else if (!validatePhone(elements.phoneInput.value)) {
          showError(elements.phoneError, "Please enter a valid phone number");
          isValid = false;
        }

        if (!elements.addressInput.value.trim()) {
          showError(elements.addressError, "Address is required");
          isValid = false;
        }

        if (
          elements.businessRole.checked &&
          !elements.companyNameInput.value.trim()
        ) {
          showError(
            elements.companyNameError,
            "Company name is required for business accounts"
          );
          isValid = false;
        }

        if (!elements.passwordInput.value) {
          showError(elements.passwordError, "Password is required");
          isValid = false;
        } else if (elements.passwordInput.value.length < 8) {
          showError(
            elements.passwordError,
            "Password must be at least 8 characters long"
          );
          isValid = false;
        } else if (checkPasswordStrength(elements.passwordInput.value) < 2) {
          showError(
            elements.passwordError,
            "Password needs mixed case or numbers"
          );
          isValid = false;
        }

        if (!elements.confirmPasswordInput.value) {
          showError(
            elements.confirmPasswordError,
            "Please confirm your password"
          );
          isValid = false;
        } else if (
          elements.confirmPasswordInput.value !== elements.passwordInput.value
        ) {
          showError(elements.confirmPasswordError, "Passwords do not match");
          isValid = false;
        }

        if (!elements.termsAcceptCheckbox.checked) {
          showError(
            elements.termsAcceptError,
            "You must accept the terms and conditions"
          );
          isValid = false;
        }

        if (!isValid) return;

        elements.registerButton.disabled = true;
        elements.registerButton.textContent = "Creating Account...";

        try {
          const formData = {
            firstName: elements.firstNameInput.value.trim(),
            lastName: elements.lastNameInput.value.trim(),
            email: elements.emailInput.value.trim(),
            phone: elements.phoneInput.value.trim(),
            address: elements.addressInput.value.trim(),
            password: elements.passwordInput.value,
            confirmPassword: elements.confirmPasswordInput.value,
            termsAccept: elements.termsAcceptCheckbox.checked,
            role: elements.businessRole.checked ? "business" : "individual",
            ...(elements.businessRole.checked && {
              companyName: elements.companyNameInput.value.trim(),
              employeeCount: document.getElementById("employeeCount").value,
            }),
          };

          const response = await fetch("/api/auth/register", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(formData),
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Registration failed");
          }

          window.location.href = "/";
        } catch (error) {
          if (error.message.includes("email")) {
            showError(
              elements.emailError,
              error.message || "This email is already registered"
            );
          } else {
            showError(
              elements.passwordError,
              error.message || "Registration failed. Please try again."
            );
          }
          elements.registerButton.disabled = false;
          elements.registerButton.textContent = "Create Account";
        }
      });

      // Clear errors on input
      [
        elements.firstNameInput,
        elements.lastNameInput,
        elements.emailInput,
        elements.phoneInput,
        elements.addressInput,
        elements.passwordInput,
        elements.confirmPasswordInput,
        elements.companyNameInput,
      ].forEach((input) => {
        input.addEventListener("input", () => {
          const errorElement = elements[`${input.id}Error`];
          if (errorElement) hideError(errorElement);
        });
      });

      elements.termsAcceptCheckbox.addEventListener("change", () => {
        hideError(elements.termsAcceptError);
      });
    </script>
  </body>
</html>
